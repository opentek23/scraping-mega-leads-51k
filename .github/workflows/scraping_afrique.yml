name: ğŸŒ Scraping Afrique Auto - 17.8K Leads

on:
  schedule:
    - cron: '0 6,14,22 * * *'  # 3 runs par jour
  workflow_dispatch:
    inputs:
      target_leads:
        description: 'Objectif leads par run'
        required: false
        default: '1500'
      test_mode:
        description: 'Mode test (true/false)'
        required: false
        default: 'false'

jobs:
  scraping-afrique:
    runs-on: ubuntu-latest
    timeout-minutes: 120
    
    steps:
    - name: ğŸ“¥ Checkout Repository
      uses: actions/checkout@v3
      
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'
        cache: 'pip'
        
    - name: ğŸ“¦ Install Dependencies
      run: |
        pip install -r requirements.txt
        sudo apt-get update
        sudo apt-get install -y google-chrome-stable
        
    - name: ğŸ¯ Run Africa Mega Scraping
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        RUN_NUMBER: ${{ github.run_number }}
        TARGET_LEADS: ${{ github.event.inputs.target_leads || '1500' }}
        TEST_MODE: ${{ github.event.inputs.test_mode || 'false' }}
      run: |
        echo "ğŸš€ DÃ©marrage scraping Afrique..."
        echo "ğŸ¯ Objectif: $TARGET_LEADS leads"
        echo "âš™ï¸ Mode test: $TEST_MODE"
        python scripts/scraping_afrique_mega.py
        
    - name: ğŸ“Š Upload Results as Artifacts
      uses: actions/upload-artifact@v3
      with:
        name: afrique-leads-run-${{ github.run_number }}
        path: |
          data/afrique_*.csv
          data/afrique_*.json
          data/stats_*.json
          data/summary_*.json
        retention-days: 90
        
    - name: ğŸ·ï¸ Create Release with CSV
      if: success()
      uses: softprops/action-gh-release@v1
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      with:
        tag_name: afrique-v${{ github.run_number }}
        name: "ğŸŒ Leads Afrique #${{ github.run_number }}"
        files: |
          data/afrique_*.csv
        body: |
          ## ğŸŒ Scraping Afrique Automatique
          
          **ğŸ“… Date:** ${{ github.event.head_commit.timestamp }}
          **ğŸ”¢ Run:** #${{ github.run_number }}
          **ğŸ¯ Cibles:** Entrepreneurs, Consultants, Managers, CrÃ©ateurs, PersonnalitÃ©s, Entreprises, Artistes, Musiciens
          **ğŸŒ Pays:** Nigeria, South Africa, Kenya, Ghana, Morocco, Egypt
          
          ### ğŸ“Š RÃ©sultats de ce run
          - Fichier CSV tÃ©lÃ©chargeable ci-dessous
          - DonnÃ©es JSON dans les artifacts
          - Statistiques dÃ©taillÃ©es incluses
          
          ### ğŸ“ Comment utiliser
          1. TÃ©lÃ©charger le fichier CSV
          2. Ouvrir avec Excel/Google Sheets
          3. Filtrer par cible/pays selon vos besoins
          
          **ğŸ¯ Objectif global: 17,800 leads Afrique**
        draft: false
        prerelease: false
        
    - name: ğŸ“ˆ Update Progress Summary
      if: always()
      run: |
        echo "ğŸ“Š Run #${{ github.run_number }} terminÃ©"
        echo "ğŸ“… $(date)"
        echo "ğŸ”— Artifacts disponibles dans l'onglet Actions"
        echo "ğŸ·ï¸ Release crÃ©Ã©e avec CSV tÃ©lÃ©chargeable"
